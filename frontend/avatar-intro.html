<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Meet Your Avatar</title>
  <style>
    :root{--bg:#120018;--card:#1e0a2a;--accent:#ff66c4;--text:#fff;--muted:rgba(255,255,255,0.8)}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Helvetica,Arial}
    body{background:linear-gradient(135deg,#120018,#2b0036);display:flex;align-items:center;justify-content:center;color:var(--text)}
    .container{width:100%;max-width:720px;padding:28px;box-sizing:border-box;text-align:center}

    .stage{background:transparent;padding:28px;border-radius:14px;display:flex;flex-direction:column;align-items:center;gap:24px}

    /* Avatar image styling */
    .avatar-wrap{width:240px;height:240px;display:flex;align-items:center;justify-content:center;transform:scale(0.7);opacity:0;animation:avatarZoom 700ms cubic-bezier(.2,.9,.3,1) forwards}
    .avatar-wrap img{width:100%;height:100%;object-fit:contain}

    @keyframes avatarZoom{to{transform:scale(1);opacity:1}}

    /* Dialogue bubbles */
    .dialogue-container{width:100%;max-width:560px}
    .bubble-line{display:flex;gap:12px;margin-bottom:16px;align-items:flex-start;opacity:0;animation:bubbleSlide 500ms ease-out forwards}
    .bubble-line:nth-child(1){animation-delay:700ms}
    .bubble-line:nth-child(2){animation-delay:1400ms}

    @keyframes bubbleSlide{
      from{opacity:0;transform:translateX(-20px)}
      to{opacity:1;transform:translateX(0)}
    }

    .bubble{background:linear-gradient(180deg,#fff,#f3f3ff);color:#111;padding:12px 16px;border-radius:12px;max-width:400px;box-shadow:0 8px 20px rgba(0,0,0,0.3);font-size:15px;line-height:1.5}
    .bubble.lead{background:linear-gradient(180deg,#ff66c4,#ff99dd);color:#fff}
    .avatar-name{font-size:12px;color:rgba(255,255,255,0.7);font-weight:600;text-transform:uppercase;letter-spacing:0.5px}

    /* Action buttons */
    .action{margin-top:20px;opacity:0;animation:fadeInUp 500ms ease-out 2000ms forwards}
    .action p{color:rgba(255,255,255,0.6);font-size:13px;margin:0}

    @keyframes fadeInUp{
      from{opacity:0;transform:translateY(10px)}
      to{opacity:1;transform:translateY(0)}
    }

    @media (max-width:480px){
      .avatar-wrap{width:160px;height:160px}
      .bubble{max-width:280px;font-size:14px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="stage">
      <!-- Selected Avatar Display -->
      <div class="avatar-wrap" aria-hidden="true">
        <img id="avatarImage" src="" alt="Your selected avatar">
      </div>

      <!-- Dialogue Bubbles -->
      <div class="dialogue-container">
        <div class="bubble-line">
          <div>
            <div class="avatar-name" id="avatarNameLabel"></div>
            <div class="bubble" id="bubble1"></div>
          </div>
        </div>
        <div class="bubble-line">
          <div>
            <div class="avatar-name" id="avatarNameLabel2"></div>
            <div class="bubble lead" id="bubble2"></div>
          </div>
        </div>
      </div>

      <!-- Transition message -->
      <div class="action">
        <p>Preparing your dashboardâ€¦</p>
      </div>
    </div>
  </div>

  <!-- Import dialogue module -->
  <script type="module">
    import { getAvatar, interpolate } from './dialogue.js';

    (async function() {
      // Read selection from sessionStorage
      const avatarId = sessionStorage.getItem('selectedAvatarId') || 'avatar1';
      const adminName = sessionStorage.getItem('adminDisplayName') || 'Admin';

      // Get avatar data
      const avatar = getAvatar(avatarId);
      if (!avatar) {
        console.warn('Avatar not found, redirecting...');
        window.location.href = 'admin-dashboard.html';
        return;
      }

      // Populate avatar display
      document.getElementById('avatarImage').src = avatar.image;
      document.getElementById('avatarImage').alt = `${avatar.name} avatar`;

      // Set avatar name labels
      const nameLabels = document.querySelectorAll('[id^="avatarNameLabel"]');
      nameLabels.forEach(label => {
        label.textContent = avatar.name;
      });

      // Dialogue messages
      const intro1 = `Nice to meet you ${adminName}`;
      const intro2 = `Let's set up the game, shall we?`;

      // Populate bubbles (they animate in via CSS)
      document.getElementById('bubble1').textContent = intro1;
      document.getElementById('bubble2').textContent = intro2;

      // After animations complete and a short pause, redirect
      setTimeout(() => {
        document.body.style.transition = 'opacity 1000ms ease';
        document.body.style.opacity = '0';
        setTimeout(() => {
          window.location.href = 'admin-dashboard.html';
        }, 300);
      }, 5000); // Allow animations to play
    })();
  </script>
</body>
</html>